#!/bin/zsh

.autocomplete.history-search.completion-widget() {
  local curcontext=$curcontext; [[ -z $curcontext ]] &&
    curcontext=history-search:::

  local +h -a comppostfuncs=( "$comppostfuncs[@]" .autocomplete.history-search.comppostfunc )
  _main_complete _autocomplete.history_lines
  (( compstate[nmatches] > 0 ))
}

.autocomplete.history-search.comppostfunc() {
  compstate[insert]='menu:0'
  compstate[list]='list force'
}

.autocomplete.history-search.completion-widget "$@"
